#!/bin/bash

CURRENT_USER=$(whoami)

while true
do
    ACTIVE_TORRENTS=0
    COMPLETED_TORRENTS=0

    TORRENT_LIST=$(transmission-remote -l)
    TORRENT_COUNT=$(echo "$TORRENT_LIST" | wc -l)

    if [ $TORRENT_COUNT -gt 2 ]; then
       ACTIVE_TORRENTS=1 
       if [ $(echo "$TORRENT_LIST" | sed '1d' | sed '$d' | grep Done | wc -l) -gt 0 ]; then COMPLETED_TORRENTS=1; fi
    fi

    echo "$ACTIVE_TORRENTS:$COMPLETED_TORRENTS" > /home/$CURRENT_USER/.torrentind

    sleep 30
done
